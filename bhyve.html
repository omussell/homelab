<html><head>
	<title>omussell/github</title>

</head>

<body bgcolor="FFFFFF">

<center>
<h1>
Bhyve</h1></center>

<p>Preparing the host: Load the bhyve kernel module, then create a tap interface for the network device.</p>
<p><code># kldload vmm</code></p>
<p><code># ifconfig tap0 create</code></p>
<p><code># sysctl net.link.tap.up_on_open=1</code></p>
<p><code># ifconfig bridge0 create</code></p>
<p><code># ifconfig bridge0 addm re0 addm tap0	### Use ifconfig to find your NIC name ###</code></p>
<p><code># ifconfig bridge0 up</code></p>

<p>Creating a FreeBSD guest: Create a virtual disk for the VM, download a FreeBSD bootonly ISO, start using the vmrun.sh script</p>
<p><code># truncate -s 16G guest.img</code></p>

<p><code># fetch $path_to_FreeBSD10.2_bootonly.iso</code></p>

<p><code># sh /usr/share/examples/bhyve/vmrun.sh -c 4 -m 1024M -t tap0 -d guest.img -i -I FreeBSD10.2_bootonly.iso guestname</code></p>

<p>Reboot the VM, during reboot, press 4 to reboot to exit the loop. The guest can then be run from hard disk.</p>
<p><code># sh /usr/share/examples/bhyve/vmrun.sh -c 4 -m 1024M -t tap0 -d guest.img guestname</code></p>

<p>Using ZFS with bhyve guests: Use ZFS volumes instead of disk image files for performance benefits.</p>
<p><code># zfs create -V16G -o volmode=dev zroot/guestdisk0</code></p>

<p>When starting the VM, specify the ZFS volume as the disk drive</p>
<p><code># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap1 -s3:0,virtio-blk,/dev/zvol/zroot/guestdisk0 -l  com1,stdio -c 4 -m 1024M guestname</code></p>

<p>Virtual machine consoles: have the console of bhyve be a null modem device that can be accessed with <code>cu</code></p>
<p><code># kldload nmdm</code></p>
<p><code># bhyve -A -H -P -s 0:0,hostbridge -s 1:0,lpc -s 2:0,virtio-net,tap1 -s 3:0,virtio-blk,./linux.img -l com1,/dev/nmdm0A -c 4 -m 1024M linuxguest</code></p>
<p><code># cu -l /dev/nmdm0B -s 9600</code></p>

<p>Managing virtual machines: device nodes are created in /dev/vmm</p>
<p><code># ls -al /dev/vmm</code></p>
<p>VMs can then be destroyed:</p>
<p><code># bhyvectl --destroy --vm=guestname</code></p>

</body>
</html>
